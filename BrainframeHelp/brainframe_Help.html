
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Brainframe:</title><meta name="generator" content="MATLAB 9.8"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2021-02-15"><meta name="DC.source" content="brainframe_Help.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Brainframe:</h1><!--introduction--><p>a tool for visualizing per-voxel or per-region data, as well as connectome data, in a 3D surface representation of a brain. This function has been tested for and works using mice and human brain atlases, but may well work with other species' brains.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Syntax &amp; Basic Use:</a></li><li><a href="#4">Fields of input_struct:</a></li><li><a href="#5">Use-Case Examples:</a></li><li><a href="#6">Resetting the colormap and region_groups for visualization:</a></li><li><a href="#7">Increasing the density of points relative to the prior visualization:</a></li><li><a href="#8">Using non-centered pointclouds, rather than centred pointclouds:</a></li><li><a href="#9">Using spheres rather than pointclouds for per-region visualizations:</a></li><li><a href="#10">Only visualizing certain regions:</a></li><li><a href="#11">Visualizing connectivity for the above selected regions:</a></li><li><a href="#12">Making per-voxel visualizations:</a></li><li><a href="#13">Visualizing data in humans:</a></li><li><a href="#14">Visualizing human connectivity data:</a></li></ul></div><h2 id="1">Syntax &amp; Basic Use:</h2><p>The below creates a 3D human brain rendering following the fields of input_struct. Use brainfram_inputs_human, with fieldnames specified as name-value pairs, to create your own input_struct. No inputs yields the default human input_struct.</p><pre class="codeinput">matpath = cd; <span class="comment">%Change this to alter the path you load from</span>
input_struct = brainframe_inputs_human(matpath);
brainframe(input_struct)
</pre><img vspace="5" hspace="5" src="brainframe_Help_01.png" alt=""> <p>The below creates a 3D mouse brain rendering following the fields of input_struct. Use brainfram_inputs_mouse, with fieldnames specified as name-value pairs, to create your own input_struct. No inputs yields the default mouse input_struct.</p><pre class="codeinput">matpath = cd; <span class="comment">%Change this to alter the path you load from</span>
input_struct = brainframe_inputs_mouse(matpath);
brainframe(input_struct)
view([-1 0 0]);
</pre><img vspace="5" hspace="5" src="brainframe_Help_02.png" alt=""> <p>Fields of input_struct can also be modified directly as below. Note the increase in pointcloud density relative to the above image after xfac is changed.</p><pre class="codeinput">input_struct.xfac = 5;
brainframe(input_struct)
view([-1 0 0]);
</pre><img vspace="5" hspace="5" src="brainframe_Help_03.png" alt=""> <img vspace="5" hspace="5" src="brainframe_Help_04.png" alt=""> <h2 id="4">Fields of input_struct:</h2><p>voxUreg: Binary flag for per-voxel or per-region visualizations. Human &amp; mouse defaults are both 0.</p><p>brain_atlas: 3D atlas with numeric regional IDs per-voxel. Human default is the 86-region Desikan &amp; mouse default is the 213-region AIBS CCF. bgcolor: Image background color. Options are 'k', 'w', 'other' (which produces gray). Human &amp; mouse defaults are 'k'.</p><p>savenclose: Binary flag indicating whether the user wants images of on axis views saved and the GUI to close (value = 1), or whether the user wants to open the GUI (value = 0). Mouse and human defaults are both 0.</p><p>img_labels: Your desired filename, as a string, if savenclose == 1. Default is 'yourfilename'.</p><p>img_format: Desired image file format as a string, if savenclose == 1. Default is 'png'.</p><p>data: Desired data input, specified as either a vector of per-voxel or per-region entries. Per voxel data can also be specified as a 3D matrix. Default for humans is per-region tau PET pathology data and the default for mice if per-region sem-quantitative tau IHC/IF data.</p><p>nbin: Number of bins per voxel data is divided into for colormap visualization. This field only applies to per-voxel data. Default is 1.</p><p>nreg: Number of regions to go through in specified atlas. This must be a number equal to  the number of unique region IDs in brain_atlas. This field is only relevant for per-region data. Default is 86 for humans and 426 for mice.</p><p>region_groups: This is a vector specifying the group each region is part of for colormap purposes. This vector must be the of length nreg. Default is an 86-element vector of 1s for humans and a 426 element vector of 1s for mice.</p><p>sphere: Binary flag specifying whether or not to visualize spheres at region centers. This field is relevant only for per-region visualizations. Default is 0.</p><p>sphere_npts: This field specifies how many points are used to construct the spheres, relative to each sphere's radius. Default is 100.</p><p>centered: This is a two element vector, with fields specifying different elements of pointcloud functionality. The first element is a binary flag specifying whether or not the pointclouds are centered at each regional centroid. The second element denotes the degree of centering, with higher numbers resulting in more centering. Default is [1 2].</p><p>cmap: The colormap used in either per-region or per-voxel visualizations. For per-region visualizations, this must be a number of unique region_groups X 3 matrix of RGB vectors per row. For per-voxel visualizations, this must be an nbin X 3 matrix of RGB vectors per row. Default is [1 0 0].</p><p>xfac: Universal multiplier for sphere radius sizes or point cloud size and density for both per-region and per-voxel visulizations. Default = 1.</p><p>pointsize: Specifies the size of points in the visualizations. Default is 50 for humans and 10 for mice.</p><p>iscon: Binary flag specifying whether to visualize connectivity. Default is 0.</p><p>conmat: Connectivity matrix that is nreg X nreg. Default is 86 X 86 Desikan connectome for humans and the 426 X 426 AIBS connectome for mice.</p><p>con_rescale: Universal connectivity multiplier that scales the number of and spread of the ellipses plotted to visually simulate neural connectivity. Ellipses are visualized per region pairs in a number proportional to the C(i,j) entry of the connectome. The default for humans is 1 and the default for mice is 0.01.</p><p>con_width: Specifies the line width of each ellipse visualized. The default is 0.01.</p><p>con_regiongroups: A vector that specifies region groups as integers for the connectivity visualization colormap. This field works analogously to region_groups. Defaults are the same as for region_groups.</p><p>con_cmap: The colormap for connectivity visualizations. This field works analogously to cmap. The default is [0 0.447 0.741].</p><p>con_arch: This field specifies the degree of curvature in the ellipses. Default is 0.5.</p><p>conarrow_WL: Specifies the width and length of the cone arrows used to indicate direction of connection between each region pair. Defaults are [1.5 2.5] in humans and [0.5 0.8] in mice.</p><h2 id="5">Use-Case Examples:</h2><p>The below examples are to illustrate various brainframe use cases.</p><h2 id="6">Resetting the colormap and region_groups for visualization:</h2><p>Visualizing pathology in mice using major region groups from the Raj Lab, to illustrate use of region_groups and cmap input_struct fields to create colormapped per-region visualizations.</p><pre class="codeinput">reggroups = zeros(213,1); <span class="comment">%Chunk of code to define region_groups</span>
amy = 1:11; cer = 12:23; sub = 24:26; hip = 27:37; hyp = 38:57;
ncx = 58:95; med = 96:120; mid = 121:141; olf = 142:149; pal = 150:157;
pon = 158:170; str = 171:178; tha = 179:213;
reggroups(amy) = 1; reggroups(cer) = 2; reggroups(sub) = 3;
reggroups(hip) = 4; reggroups(hyp) = 5; reggroups(ncx) = 6;
reggroups(med) = 7; reggroups(mid) = 8; reggroups(olf) = 9;
reggroups(pal) = 10; reggroups(pon) = 11; reggroups(str) = 12;
reggroups(tha) = 13;
reggroups = [reggroups;reggroups];

cmap = hsv(length(unique(reggroups))); <span class="comment">%Setting colormap</span>

matpath = cd;
input_struct = brainframe_inputs_mouse(matpath,<span class="string">'region_groups'</span>,<span class="keyword">...</span>
    reggroups,<span class="string">'cmap'</span>,cmap);
brainframe(input_struct)
view([-1 0 0]);
</pre><img vspace="5" hspace="5" src="brainframe_Help_05.png" alt=""> <h2 id="7">Increasing the density of points relative to the prior visualization:</h2><pre class="codeinput">input_struct = brainframe_inputs_mouse(matpath,<span class="string">'region_groups'</span>,<span class="keyword">...</span>
    reggroups,<span class="string">'cmap'</span>,cmap,<span class="string">'xfac'</span>,5);
brainframe(input_struct)
view([-1 0 0]);
</pre><img vspace="5" hspace="5" src="brainframe_Help_06.png" alt=""> <img vspace="5" hspace="5" src="brainframe_Help_07.png" alt=""> <h2 id="8">Using non-centered pointclouds, rather than centred pointclouds:</h2><pre class="codeinput">input_struct = brainframe_inputs_mouse(matpath,<span class="string">'region_groups'</span>,<span class="keyword">...</span>
    reggroups,<span class="string">'cmap'</span>,cmap,<span class="string">'xfac'</span>,5,<span class="string">'centered'</span>,[0 1]);
brainframe(input_struct)
view([-1 0 0]);
</pre><img vspace="5" hspace="5" src="brainframe_Help_08.png" alt=""> <img vspace="5" hspace="5" src="brainframe_Help_09.png" alt=""> <h2 id="9">Using spheres rather than pointclouds for per-region visualizations:</h2><p>Note that xfac for spheres is often quite different than pointclouds</p><pre class="codeinput">input_struct = brainframe_inputs_mouse(matpath,<span class="string">'region_groups'</span>,<span class="keyword">...</span>
    reggroups,<span class="string">'cmap'</span>,cmap,<span class="string">'xfac'</span>,0.1,<span class="string">'sphere'</span>,1);
brainframe(input_struct)
view([-1 0 0]);
</pre><img vspace="5" hspace="5" src="brainframe_Help_10.png" alt=""> <h2 id="10">Only visualizing certain regions:</h2><p>Use case here shows uniform data only for the hippocampus in the RH.</p><pre class="codeinput">datavec = zeros(426,1);
datavec(27:37) = 1;
input_struct = brainframe_inputs_mouse(matpath,<span class="string">'region_groups'</span>,<span class="keyword">...</span>
    reggroups,<span class="string">'cmap'</span>,cmap,<span class="string">'xfac'</span>,0.075,<span class="string">'sphere'</span>,1,<span class="string">'data'</span>,datavec);
brainframe(input_struct)
view([-1 0 0]);
</pre><img vspace="5" hspace="5" src="brainframe_Help_11.png" alt=""> <h2 id="11">Visualizing connectivity for the above selected regions:</h2><p>Visualizing all connections at once is not recommended. For this use case direct modification of input_struct is likely easiest.</p><pre class="codeinput">input_struct.iscon = 1; <span class="comment">%Turn on connectivity visualization binary flag</span>

input_struct.conmat = input_struct.conmat - <span class="keyword">...</span>
    diag(diag(input_struct.conmat)); <span class="comment">%zeroing out the diagonal</span>
input_struct.conmat(1:26,:) = 0; <span class="comment">%zeroing out all non-hippocampal data</span>
input_struct.conmat(27:37,[1:26 38:end]) = 0;
input_struct.conmat(38:end,:) = 0;
input_struct.conmat(<span class="keyword">...</span><span class="comment"> %This line thresholds conmat, we recommend this</span>
    input_struct.conmat&lt;0.5*mean(nonzeros(input_struct.conmat))) = 0;

brainframe(input_struct);
view([-1 0 0]);
</pre><img vspace="5" hspace="5" src="brainframe_Help_12.png" alt=""> <h2 id="12">Making per-voxel visualizations:</h2><p>The example here is an estimated distribution of L4 neurons in the mouse brain, with bins and colormaps used to denote density per voxel in addition to pointcloud density. Note voxUreg is now 0. Also note that data must be co-registered to your brain atlas, as shown below.</p><pre class="codeinput">matpath = cd;
load([matpath filesep <span class="string">'PerVox_ExampleData.mat'</span>],<span class="string">'pervoxdata'</span>); <span class="comment">%Ex. data</span>
datinput = pervoxdata.Pvalb; <span class="comment">%Pvalb+ GABAergic interneurons</span>
datinput = imresize3(datinput,[133 81 115]); <span class="comment">%Co-registering data to CCF</span>
datinput(datinput&lt;0) = 0; <span class="comment">%Getting rid of negative artifacts</span>

input_struct = brainframe_inputs_mouse(matpath,<span class="string">'voxUreg'</span>,0,<span class="string">'data'</span>,<span class="keyword">...</span>
    datinput,<span class="string">'nbin'</span>,5,<span class="string">'cmap'</span>,autumn(5)); <span class="comment">%Note size(cmap,1)==nbin</span>
brainframe(input_struct);
view([-1 0 0]);
</pre><img vspace="5" hspace="5" src="brainframe_Help_13.png" alt=""> <h2 id="13">Visualizing data in humans:</h2><p>Using regional pathology as an example, with a general mutlipler of 5. Note the syntax is the same as with mice, with the exception that a different input_struct generating function is called.</p><pre class="codeinput">matpath = cd;
load([matpath filesep <span class="string">'brainframe_defaultHuman_datinput.mat'</span>],<span class="string">'testdata'</span>);
input_struct = brainframe_inputs_human(matpath,<span class="string">'xfac'</span>,1,<span class="string">'data'</span>,testdata);
brainframe(input_struct)
</pre><img vspace="5" hspace="5" src="brainframe_Help_14.png" alt=""> <h2 id="14">Visualizing human connectivity data:</h2><p>Here we visualize connections only above a threshold, with a sphere of uniform size at the regional centroid. Note that the 'data' field is also reset to only create spheres in thoseregions participating in above threshold connections.</p><pre class="codeinput">input_struct.sphere = 1; <span class="comment">%Setting binary flag for spheres to 1</span>

input_struct.iscon = 1; <span class="comment">%Turn on connectivity visualization binary flag</span>

input_struct.conmat = input_struct.conmat - <span class="keyword">...</span>
    diag(diag(input_struct.conmat)); <span class="comment">%zeroing out the diagonal</span>
input_struct.conmat(input_struct.conmat&lt;50) = 0; <span class="comment">%setting threshold for visualization</span>

[fROI,~] = find(input_struct.conmat);
fROI = unique(fROI); <span class="comment">%These lines only work for symmetric matrices</span>
input_struct.data = zeros(input_struct.nreg,1);
input_struct.data(fROI) = 1; <span class="comment">%Only render spheres above threshold regions</span>
input_struct.xfac = 0.5; <span class="comment">%Remember sphere rescaling very different</span>

brainframe(input_struct);
</pre><img vspace="5" hspace="5" src="brainframe_Help_15.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Brainframe: 
% a tool for visualizing per-voxel or per-region data, as well
% as connectome data, in a 3D surface representation of a brain. This
% function has been tested for and works using mice and human brain 
% atlases, but may well work with other species' brains.

%% Syntax & Basic Use:
% The below creates a 3D human brain rendering following the fields of 
% input_struct. Use brainfram_inputs_human, with fieldnames specified as
% name-value pairs, to create your own input_struct. No inputs yields the
% default human input_struct.
matpath = cd; %Change this to alter the path you load from
input_struct = brainframe_inputs_human(matpath);
brainframe(input_struct)

%% 
% The below creates a 3D mouse brain rendering following the fields of 
% input_struct. Use brainfram_inputs_mouse, with fieldnames specified as
% name-value pairs, to create your own input_struct. No inputs yields the
% default mouse input_struct.
matpath = cd; %Change this to alter the path you load from
input_struct = brainframe_inputs_mouse(matpath);
brainframe(input_struct)
view([-1 0 0]);

%%
% Fields of input_struct can also be modified directly as below. Note the
% increase in pointcloud density relative to the above image after xfac is
% changed.
input_struct.xfac = 5;
brainframe(input_struct)
view([-1 0 0]);

%% Fields of input_struct:
% voxUreg: Binary flag for per-voxel or per-region visualizations. Human &
% mouse defaults are both 0.
% 
% brain_atlas: 3D atlas with numeric regional IDs per-voxel. Human default
% is the 86-region Desikan & mouse default is the 213-region AIBS CCF.
% bgcolor: Image background color. Options are 'k', 'w', 'other' (which
% produces gray). Human & mouse defaults are 'k'.
% 
% savenclose: Binary flag indicating whether the user wants images of on
% axis views saved and the GUI to close (value = 1), or whether the user 
% wants to open the GUI (value = 0). Mouse and human defaults are both 0.
% 
% img_labels: Your desired filename, as a string, if savenclose == 1.
% Default is 'yourfilename'.
% 
% img_format: Desired image file format as a string, if savenclose == 1.
% Default is 'png'.
% 
% data: Desired data input, specified as either a vector of per-voxel or 
% per-region entries. Per voxel data can also be specified as a 3D matrix.
% Default for humans is per-region tau PET pathology data and the default
% for mice if per-region sem-quantitative tau IHC/IF data.
% 
% nbin: Number of bins per voxel data is divided into for colormap
% visualization. This field only applies to per-voxel data. Default is 1.
% 
% nreg: Number of regions to go through in specified atlas. This must be a
% number equal to  the number of unique region IDs in brain_atlas. This
% field is only relevant for per-region data. Default is 86 for humans and
% 426 for mice.
% 
% region_groups: This is a vector specifying the group each region is part
% of for colormap purposes. This vector must be the of length nreg. Default
% is an 86-element vector of 1s for humans and a 426 element vector of 1s
% for mice.
% 
% sphere: Binary flag specifying whether or not to visualize spheres at
% region centers. This field is relevant only for per-region
% visualizations. Default is 0.
% 
% sphere_npts: This field specifies how many points are used to construct
% the spheres, relative to each sphere's radius. Default is 100.
% 
% centered: This is a two element vector, with fields specifying different
% elements of pointcloud functionality. The first element is a binary flag
% specifying whether or not the pointclouds are centered at each regional
% centroid. The second element denotes the degree of centering, with higher
% numbers resulting in more centering. Default is [1 2].
% 
% cmap: The colormap used in either per-region or per-voxel visualizations.
% For per-region visualizations, this must be a number of unique
% region_groups X 3 matrix of RGB vectors per row. For per-voxel
% visualizations, this must be an nbin X 3 matrix of RGB vectors per row.
% Default is [1 0 0].
% 
% xfac: Universal multiplier for sphere radius sizes or point cloud size 
% and density for both per-region and per-voxel visulizations. Default = 1.
% 
% pointsize: Specifies the size of points in the visualizations. Default is
% 50 for humans and 10 for mice.
% 
% iscon: Binary flag specifying whether to visualize connectivity. Default
% is 0.
% 
% conmat: Connectivity matrix that is nreg X nreg. Default is 86 X 86
% Desikan connectome for humans and the 426 X 426 AIBS connectome for mice.
% 
% con_rescale: Universal connectivity multiplier that scales the number of
% and spread of the ellipses plotted to visually simulate neural 
% connectivity. Ellipses are visualized per region pairs in a number  
% proportional to the C(i,j) entry of the connectome. The default for  
% humans is 1 and the default for mice is 0.01.
% 
% con_width: Specifies the line width of each ellipse visualized. The 
% default is 0.01.
% 
% con_regiongroups: A vector that specifies region groups as integers for 
% the connectivity visualization colormap. This field works analogously to
% region_groups. Defaults are the same as for region_groups.
% 
% con_cmap: The colormap for connectivity visualizations. This field works
% analogously to cmap. The default is [0 0.447 0.741].
% 
% con_arch: This field specifies the degree of curvature in the ellipses.
% Default is 0.5.
% 
% conarrow_WL: Specifies the width and length of the cone arrows used to
% indicate direction of connection between each region pair. Defaults are 
% [1.5 2.5] in humans and [0.5 0.8] in mice.

%% Use-Case Examples:
% The below examples are to illustrate various brainframe use cases.

%% Resetting the colormap and region_groups for visualization:
% Visualizing pathology in mice using major region groups from the Raj Lab,
% to illustrate use of region_groups and cmap input_struct fields to create 
% colormapped per-region visualizations.

reggroups = zeros(213,1); %Chunk of code to define region_groups
amy = 1:11; cer = 12:23; sub = 24:26; hip = 27:37; hyp = 38:57; 
ncx = 58:95; med = 96:120; mid = 121:141; olf = 142:149; pal = 150:157;
pon = 158:170; str = 171:178; tha = 179:213;
reggroups(amy) = 1; reggroups(cer) = 2; reggroups(sub) = 3; 
reggroups(hip) = 4; reggroups(hyp) = 5; reggroups(ncx) = 6;
reggroups(med) = 7; reggroups(mid) = 8; reggroups(olf) = 9;
reggroups(pal) = 10; reggroups(pon) = 11; reggroups(str) = 12;
reggroups(tha) = 13;
reggroups = [reggroups;reggroups];

cmap = hsv(length(unique(reggroups))); %Setting colormap

matpath = cd;
input_struct = brainframe_inputs_mouse(matpath,'region_groups',...
    reggroups,'cmap',cmap);
brainframe(input_struct)
view([-1 0 0]);

%% Increasing the density of points relative to the prior visualization:

input_struct = brainframe_inputs_mouse(matpath,'region_groups',...
    reggroups,'cmap',cmap,'xfac',5);
brainframe(input_struct)
view([-1 0 0]);

%% Using non-centered pointclouds, rather than centred pointclouds:

input_struct = brainframe_inputs_mouse(matpath,'region_groups',...
    reggroups,'cmap',cmap,'xfac',5,'centered',[0 1]);
brainframe(input_struct)
view([-1 0 0]);

%% Using spheres rather than pointclouds for per-region visualizations:
% Note that xfac for spheres is often quite different than pointclouds

input_struct = brainframe_inputs_mouse(matpath,'region_groups',...
    reggroups,'cmap',cmap,'xfac',0.1,'sphere',1);
brainframe(input_struct)
view([-1 0 0]);

%% Only visualizing certain regions: 
% Use case here shows uniform data only for the hippocampus in the RH.

datavec = zeros(426,1);
datavec(27:37) = 1;
input_struct = brainframe_inputs_mouse(matpath,'region_groups',...
    reggroups,'cmap',cmap,'xfac',0.075,'sphere',1,'data',datavec);
brainframe(input_struct)
view([-1 0 0]);

%% Visualizing connectivity for the above selected regions: 
% Visualizing all connections at once is not recommended. For this use case 
% direct modification of input_struct is likely easiest.

input_struct.iscon = 1; %Turn on connectivity visualization binary flag

input_struct.conmat = input_struct.conmat - ...
    diag(diag(input_struct.conmat)); %zeroing out the diagonal
input_struct.conmat(1:26,:) = 0; %zeroing out all non-hippocampal data
input_struct.conmat(27:37,[1:26 38:end]) = 0;
input_struct.conmat(38:end,:) = 0;
input_struct.conmat(... %This line thresholds conmat, we recommend this
    input_struct.conmat<0.5*mean(nonzeros(input_struct.conmat))) = 0;

brainframe(input_struct);
view([-1 0 0]);

%% Making per-voxel visualizations: 
% The example here is an estimated distribution of L4 neurons in the mouse 
% brain, with bins and colormaps used to denote density per voxel in 
% addition to pointcloud density. Note voxUreg is now 0. Also note that
% data must be co-registered to your brain atlas, as shown below.

matpath = cd;
load([matpath filesep 'PerVox_ExampleData.mat'],'pervoxdata'); %Ex. data
datinput = pervoxdata.Pvalb; %Pvalb+ GABAergic interneurons
datinput = imresize3(datinput,[133 81 115]); %Co-registering data to CCF
datinput(datinput<0) = 0; %Getting rid of negative artifacts

input_struct = brainframe_inputs_mouse(matpath,'voxUreg',0,'data',...
    datinput,'nbin',5,'cmap',autumn(5)); %Note size(cmap,1)==nbin
brainframe(input_struct);
view([-1 0 0]);

%% Visualizing data in humans: 
% Using regional pathology as an example, with a general mutlipler of 5. 
% Note the syntax is the same as with mice, with the exception that a
% different input_struct generating function is called.

matpath = cd;
load([matpath filesep 'brainframe_defaultHuman_datinput.mat'],'testdata');
input_struct = brainframe_inputs_human(matpath,'xfac',1,'data',testdata);
brainframe(input_struct)

%% Visualizing human connectivity data:
% Here we visualize connections only above a threshold, with a sphere of 
% uniform size at the regional centroid. Note that the 'data' field is also 
% reset to only create spheres in thoseregions participating in above 
% threshold connections.

input_struct.sphere = 1; %Setting binary flag for spheres to 1

input_struct.iscon = 1; %Turn on connectivity visualization binary flag

input_struct.conmat = input_struct.conmat - ...
    diag(diag(input_struct.conmat)); %zeroing out the diagonal
input_struct.conmat(input_struct.conmat<50) = 0; %setting threshold for visualization

[fROI,~] = find(input_struct.conmat); 
fROI = unique(fROI); %These lines only work for symmetric matrices
input_struct.data = zeros(input_struct.nreg,1);
input_struct.data(fROI) = 1; %Only render spheres above threshold regions
input_struct.xfac = 0.5; %Remember sphere rescaling very different

brainframe(input_struct);




















##### SOURCE END #####
--></body></html>